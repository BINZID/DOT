<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<!--
    Title:添加新用户页
    Description：超级管理员权限可见的添加新用户页
    Author：WangTianshan (王天山)
    Created date: 2017/9/15 21:35
    Copyright: The Research Group of Biodiversity Informatics (BiodInfo Group) - 中国科学院动物研究所生物多样性信息学研究组
    Version: Html5
 -->
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <title th:text="#{web_title}">BioIDE&nbsp;物种数据采集系统</title>
    <link rel="shortcut icon" th:href="@{/images/logo-black.png}" href="/images/logo.png" type="images/x-icon"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="description" content=""/>
    <!-- 引入css -->
    <span th:replace="pageFrame/basicsCss :: copy" />
</head>
<body class="hold-transition skin-dark fixed sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">
    <header id="header" class="main-header">
        <!-- 引入Header -->
        <span th:replace="pageFrame/basicsHeader :: copy" />
    </header>
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="container content-header">
        	<h3>
                <span>添加用户</span>
                <small>在这里您可以添加系统用户</small>
            </h3>
            <ol class="breadcrumb">
                <li><a th:href="@{/}" href="/"><i class="fa fa-home"></i> Home</a></li>
                <li><a th:href="@{/super/user}" href="user"><i class="fa fa-users"></i> 用户管理</a></li>
                <li class="active"><i class="fa fa-user-plus"></i> 添加用户</li>
            </ol>
        </section>
        <!-- Main content -->
        <section class="container content">
            <div class="well">
                <form id="thisForm" class="form-horizontal" th:action="@{/super/user/addUserBySuper}" method="post" th:object="${thisUser}">
                    <!-- 引入form -->
                    <span th:substituteby="user/form :: copy" />
                    <p></p>
                    <div class="form-group">
                        <div class="col-sm-12">
                            <div class="pull-right">
                                <a class="btn btn-app" th:href="@{/super/user}" href="/user">
                                    <i class="fa fa-chevron-left"></i> 取消编辑
                                </a>
                                <a class="btn btn-app" onclick="clearInput();">
                                    <i class="fa fa-rotate-left"></i> 清空表单
                                </a>
                                <button type="submit" class="btn btn-app">
                                    <i class="fa fa-check"></i> 提交
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </section>
    </div>
    <!-- 引入 Left side column. contains the sidebar -->
    <span th:replace="pageFrame/basicsMenu :: copy" />
    <footer class="main-footer">
        <span th:replace="pageFrame/basicsFooter :: copy" />
    </footer>
    <!-- Control Sidebar -->
    <span th:replace="pageFrame/basicsControl :: copy" />
    <!-- /.control-sidebar -->
    <!-- Add the sidebar's background. This div must be placed
         immediately after the control sidebar -->
    <div class="control-sidebar-bg"></div>
</div>
<!-- 引入js【body末尾引入js文件会使页面加载更快】 -->
<span th:replace="pageFrame/basicsJs :: copy" />
<!-- page_script -->
<script th:src="@{/js/superTableScript.js}"></script>

<!-- bootstrapValidator -->
<script th:src="@{/plugins/bootstrapValidator/js/bootstrapValidator.min.js}"></script>
<script th:src="@{/plugins/bootstrapValidator/js/language/zh_CN.js}"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    var warning_name = [[#{warning_name}]];
    /*]]>*/
</script>

<script type="text/javascript">
    var warning_rename = "用户名不可用";
    var warning_remeail = "邮箱不可用";

    $(document).ready(function () {
        //错误提示
        if ($('#errorMsg').val().length > 0)
            layer.msg($('#errorMsg').val(), function () {
            });
        //获取host
        $("#base_url").val(window.location.host);
        $('#thisForm').bootstrapValidator({
            message: 'This value is not valid',
            feedbackIcons: {
                valid: 'glyphicon ',
                invalid: 'glyphicon ',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                rename: {
                    selector: '#r_username',
                    validators: {
                        notEmpty: {},
                        stringLength: {
                            min: 2,
                            max: 30,
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_\.]+$/,
                            message: warning_rename
                        },
                        callback: {
                            message: warning_rename,
                            callback: function (value, validator) {
                                validator_name = 'register/rest/isReName';
                                $.ajax({
                                    url: 'register/rest/isReName',
                                    data: {
                                        name: $('#r_username').val()
                                    },
                                    cache: false,
                                    dataType: "json",
                                    success: function (data) {
                                        if (!data) {
                                            validator.updateStatus('rename', 'VALID', 'callback');
                                            return true;
                                        }
                                        else {
                                            return false;
                                        }
                                    },
                                    error: function () {
                                        //alert("error");
                                        return false;
                                    }
                                });
                                return false;
                            }
                        },
                    }
                },
                reemail: {
                    selector: '#r_email',
                    validators: {
                        notEmpty: {},
                        emailAddress: {},
                        stringLength: {
                            min: 6,
                            max: 70,
                        },
                        callback: {
                            message: warning_remeail,
                            callback: function (value, validator) {
                                validator_email = 'register/rest/isReEmail';
                                $.ajax({
                                    url: 'register/rest/isReEmail',
                                    data: {
                                        email: $('#r_email').val()
                                    },
                                    cache: false,
                                    dataType: "json",
                                    success: function (data) {
                                        if (!data) {
                                            validator.updateStatus('reemail', 'VALID', 'callback');
                                            return true;
                                        }
                                        else {
                                            return false;
                                        }
                                    },
                                    error: function () {
                                        //alert("error");
                                        return false;
                                    }
                                });
                                return false;
                            }
                        },
                    }
                },
                password: {
                    selector: '#password',
                    validators: {
                        notEmpty: {},
                        stringLength: {
                            min: 6,
                            max: 30,
                        },
                    }
                },
                mobile: {
                	 selector: '#mobile',
                    validators: {
                        notEmpty: {},
                        stringLength: {
                            min: 11,
                            max: 11,
                        },
                        regexp: {
                            regexp: /^1[3|4|5|7|8]\d{9}$/,
                            message: '输入不合法'
                        },
                    }
                },
                nickname: {
                	selector: '#nickname',
                    validators: {
                        notEmpty: {},
                        stringLength: {
                            min: 2,
                            max: 15,
                        },
                    }
                },
            }
        });
    });
</script>
</body>
</html>
