<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<!--
    Title:添加DataSet页面
    Description：添加DataSet页面
    Author：WangTianshan(王天山)
    Created date: 2018/08/03 00:15
    Copyright: The Research Group of Biodiversity Informatics (BiodInfo Group) - 中国科学院动物研究所生物多样性信息学研究组
    Version: Html5
 -->
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <title th:text="#{web_title}">BioIDE &nbsp;物种数据采集系统</title>
    <link rel="shortcut icon" th:href="@{/img/logo.png}" href="/images/logo.png" type="images/x-icon"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="description" content=""/>
    <!-- 引入css -->
    <th:block th:replace="pageFrame/basicsCss :: copy"></th:block>
</head>

<body>
    <!-- 内容区 -->
    <div class="col-md-12">
        <p></p>
        <form id="thisForm" class="form-horizontal" th:action="@{/console/taxtree/save}" method="post" th:object="${thisTaxtree}">
            <!-- 引入form -->
            <th:block th:replace="taxtree/form :: copy"></th:block>
            <p></p>
            <div class="form-group">
                <div class="col-sm-12">
                    <div class="pull-right">
                        <a class="btn btn-app" onclick="clearInput();">
                            <i class="fa fa-rotate-left"></i> <span>清空表单</span>
                        </a>
                        <a class="btn btn-app" onclick="addTaxtree();">
                            <i class="fa fa-check"></i> <span>提交</span>
                        </a>
                    </div>
                </div>
            </div>
        </form>
    </div>
<!-- 引入js -->

<th:block th:replace="pageFrame/basicsJs :: copy"></th:block>
<script>
    var type= 'model';
</script>
<th:block th:if="${type} eq 'dataset'">
    <script>
        type= 'dataset';
    </script>
</th:block>
<!-- page_script -->
<script th:src="@{/js/tableScript.js}"></script>
<script th:src="@{/js/taxtree/taxtreeScript.js}"></script>
<!-- bootstrapValidator -->
<script th:src="@{/plugins/bootstrapValidator/js/bootstrapValidator.min.js}"></script>
<script th:src="@{/plugins/bootstrapValidator/js/language/zh_CN.js}"></script>
<!-- page_script -->
<script th:inline="javascript">
    /*<![CDATA[*/
    var warning_Illegal= [[#{warning_Illegal}]];
    /*]]>*/
</script>
<script type="text/javascript">
/* 添加Taxtree */
function addTaxtree() {
	var obj = $('#thisForm').serialize();
	if ($('#thisForm').data('bootstrapValidator').isValid()){
		$.ajax({
			type: "POST",
			url: "/console/taxtree/rest/new",
			data: obj,	// 要提交的表单
			dataType: "json",
			contentType : 'application/x-www-form-urlencoded; charset=UTF-8',
			success: function(msg){
				var href = window.location.protocol + "/console/taxtree/toTaxtreePage/" + msg.dsid;
				if (msg.result == true) {
				    parent.layer.close(parent.layer.getFrameIndex(window.name));
					parent.window.location.href = href;
				}else{
					layer.msg("添加失败！", {time: 500}, function(){
				        parent.layer.close(parent.layer.getFrameIndex(window.name));
					});
				}
	        },
			error: function (error) {
			}
		});
	}else{
		layer.msg('请先完成表单录入', {time : 1000,}, function() {
        })
	}
};
</script>
</body>
</html>